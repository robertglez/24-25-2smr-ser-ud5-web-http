<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>06| Servidores virtuales | UNIDAD 5. Servicio web (HTTP) </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="es" />
<meta name="author" content="Roberto González Cardenete" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/4.0/" />
<meta name="generator" content="eXeLearning 2.9 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="prism.css">
</head>
<body class="exe-web-site exe-search-bar exe-atools" id="exe-node-11"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<div id="header" ><div id="headerContent">UNIDAD 5. Servicio web (HTTP)</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UNIDAD 5. Servicio web (HTTP)</a></li>
   <li><a href="01_introduccin.html" class="no-ch">01| Introducción</a></li>
   <li><a href="02_el_protocolo_http.html" class="daddy">02| El protocolo HTTP</a>
   <ul class="other-section">
      <li><a href="21_un_poco_de_historia.html" class="no-ch">2.1. Un poco de historia</a></li>
      <li><a href="22_caractersticas_de_http.html" class="no-ch">2.2. Características de HTTP</a></li>
   </ul>
   </li>
   <li><a href="03_etapas_de_una_transaccin_http.html" class="no-ch">03| Etapas de una transacción HTTP</a></li>
   <li><a href="04_el_estndar_http10.html" class="daddy">04| El estándar HTTP/1.0</a>
   <ul class="other-section">
      <li><a href="prctica_1_transacciones_http.html" class="no-ch">Práctica 1: Transacciones HTTP</a></li>
   </ul>
   </li>
   <li><a href="05_instalacin_y_configuracin_de_apache2.html" class="daddy">05| Instalación y configuración de Apache2</a>
   <ul class="other-section">
      <li><a href="prctica_2_instalacin_de_apache2.html" class="no-ch">Práctica 2: Instalación de Apache2</a></li>
   </ul>
   </li>
   <li id="active"><a href="06_servidores_virtuales.html" class="active daddy">06| Servidores virtuales</a>
   <ul>
      <li><a href="prctica_3_configuracin_bsica.html" class="no-ch">Práctica 3: Configuración básica</a></li>
   </ul>
   </li>
   <li><a href="07_acceso_annimo_y_autenticado_formas_de_autenticacin.html" class="daddy">07| Acceso anónimo y autenticado. Formas de autenticación</a>
   <ul class="other-section">
      <li><a href="prctica_4_control_de_acceso_autorizacin_y_autenticacin.html" class="no-ch">Práctica 4: Control de acceso, autorización y autenticación</a></li>
   </ul>
   </li>
   <li><a href="08_ejecucin_de_cdigo_scripts_de_servidor_y_de_cliente.html" class="daddy">08| Ejecución de código. Scripts de servidor y de cliente</a>
   <ul class="other-section">
      <li><a href="prctica_5_ejecucin_de_cdigo_en_el_cliente_y_en_el_servidor.html" class="no-ch">Práctica 5: Ejecución de código en el cliente y en el servidor</a></li>
   </ul>
   </li>
   <li><a href="09_establecimiento_de_conexiones_seguras.html" class="daddy">09| Establecimiento de conexiones seguras</a>
   <ul class="other-section">
      <li><a href="prctica_6_asegurando_las_comunicaciones.html" class="no-ch">Práctica 6: Asegurando las comunicaciones</a></li>
   </ul>
   </li>
   <li><a href="10_mapa_conceptual.html" class="no-ch">10| Mapa conceptual</a></li>
   <li><a href="11_cuestionario_de_repaso.html" class="no-ch">11| Cuestionario de repaso</a></li>
   <li><a href="12_bibliografia.html" class="no-ch">12| Bibliografia</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="prctica_2_instalacin_de_apache2.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="prctica_3_configuracin_bsica.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">06| Servidores virtuales</h1></div>
<div class="iDevice_wrapper FreeTextIdevice" id="id22">
<div class="iDevice emphasis0">
<div id="ta22_86" class="block iDevice_content">
<p>Quan parlem de la creació de llocs virtuals ens estem referint a l’acció de fer treballar més d’un lloc web, per exemple, les pàgines web <code>www.web1.cat</code> i <code>www.web2.cat</code> en un únic ordinador.</p>
<p>Tal com mostra la figura següent tot i que tots dos dominis estiguen treballant en la mateixa màquina física, mai no ens n’adonarem quan visitem aquests llocs web.</p>
<p><img src="smx_m07u3-36_1.png" alt="Servidors virtuals" title="Servidors virtuals" style="display: block; margin-left: auto; margin-right: auto;" width="430" height="623" /></p>
<p>Els llocs web virtuals es poden <strong>basar tant en adreces d'Internet (IP)</strong>, on cada lloc web té una adreça d'Internet (IP) diferent, com <strong>en noms diferents</strong>, és a dir, diversos llocs web amb diferents noms de domini estaran treballant amb una única adreça d'Internet (IP). Val a dir que, tot i que estiguem treballant en la mateixa màquina física, com a usuaris observarem que l'usuari, quan visita aquests llocs web, no se n'adona.</p>
<p>Per explicar la tècnica de la creació de llocs web virtuals, treballarem amb dos exemples:<code> www.aplicacionsweb.org</code> i <code>www.serveisenxarxa.org</code>.</p>
<p>Els dos llocs webs virtuals seran servits pel mateix servidor web. El directori per defecte on es troben les pàgines web és <code>/var/www</code>, on crearem les diferents estructures de directori. Per tant, dins dels directoris <code>/var/www/aplicacionsweb</code> i <code>/var/www/seveisenxarxa</code> trobarem els arxius dels llocs web corresponents a les pàgines web anteriors.</p>
<p>Per a la configuració i posada en marxa dels llocs web virtuals hem de construir, en primer lloc, l'estructura de directoris on desarem els llocs. Utilitzarem dintre del directori reservat a cada lloc web la carpeta de <code>public_html</code> per allotjar els arxius del lloc web.</p>
<p>Un cop definits els directoris on desarem els llocs web virtuals, haurem d’adreçar-nos al directori <code>/etc/apache2</code>, on trobarem els arxius de configuració d’Apache. En aquest cas, l'arxiu principal de configuració és <code>apache2.conf</code>.</p>
<p>Considerant que per treballar amb els llocs virtuals haurem de fer alguns canvis en el contingut de l’arxiu, haurem de considerar, abans d'establir cap canvi, quina configuració de llocs web virtuals volem crear, és a dir, llocs virtuals basats en adreces d’Internet (IP) o bé basats en noms.<span style="font-size: 1em;"></span></p>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextIdevice" id="id25">
<div class="iDevice emphasis0">
<div id="ta25_86" class="block iDevice_content">
<h3>Servidors virtuals en Apache</h3>
<p>Apache2 es lliura amb una configuració predeterminada <em>virtual-host-friendly</em>. És a dir, està configurat amb un únic <em>host</em> virtual predeterminat (utilitzant la directiva <code>VirtualHost</code>) que es pot modificar o utilitzar com si tingués un sol lloc o que s'utilitzés com a plantilla per a servidors virtuals addicionals si teniu diversos llocs. Si es deixa sol, l'amfitrió virtual predeterminat servirà com a lloc predeterminat o els usuaris del lloc veuran si l'URL que introduïu no coincideix amb la directiva <code>ServerName</code> de cap dels vostres llocs personalitzats. Per modificar el servidor virtual predeterminat, editeu el fitxer <code>/etc/apache2/sites-available/000-default.conf.</code></p>
<p><span style="font-size: 1em;">Si voleu configurar un nou host virtual o lloc, copieu aquests fitxers en el mateix directori amb el nom que seleccioneu. Per exemple:</span></p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/elmeullocweb.conf
</code></pre>
</div>
</div>
<p>La configuració per defecte és la següent:</p>
<div class="highlighted-code language-clike line-numbers">
<div>
<pre><code>&lt;VirtualHost *:80&gt;
	# The ServerName directive sets the request scheme, hostname and port that
	# the server uses to identify itself. This is used when creating
	# redirection URLs. In the context of virtual hosts, the ServerName
	# specifies what hostname must appear in the request's Host: header to
	# match this virtual host. For the default virtual host (this file) this
	# value is not decisive as it is used as a last resort host regardless.
	# However, you must set it for any further virtual host explicitly.
	#ServerName www.example.com

	ServerAdmin webmaster@localhost
	DocumentRoot /var/www/html

	# Available loglevels: trace8, ..., trace1, debug, info, notice, warn,
	# error, crit, alert, emerg.
	# It is also possible to configure the loglevel for particular
	# modules, e.g.
	#LogLevel info ssl:warn

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	# For most configuration files from conf-available/, which are
	# enabled or disabled at a global level, it is possible to
	# include a line for only one particular virtual host. For example the
	# following line enables the CGI configuration for this host only
	# after it has been globally disabled with "a2disconf".
	#Include conf-available/serve-cgi-bin.conf
&lt;/VirtualHost&gt;

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet</code></pre>
</div>
</div>
<p>Una vegada realitzats els canvis activarem en lloc web amb el comandament <code>a2ensite</code>:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>#a2ensite elmeullocweb</code></pre>
</div>
</div>
<p>Després carregarem de nou la configuració d'Apache2 amb el comandament:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>#service apache2 reload
</code></pre>
</div>
</div>
<p>Per a la depuració d'error en els arxius de configuració de llocs virtuals cal utilitzar:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>#apache2ctl -t</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextIdevice" id="id24">
<div class="iDevice emphasis0">
<div id="ta24_86" class="block iDevice_content">
<h2>Llocs virtuals basats en l’adreça d’Internet (IP)</h2>
<p>En aquest cas, podrem allotjar múltiples dominis en una única màquina que disposarà de diferents adreces d’Internet (IP) i, en cadascuna d’elles, s’hi executarà un lloc virtual.</p>
<p>Haurem de canviar la directiva <code>&lt;VirtualHost *:80&gt;</code> de forma que s'especifique a quina adreça IP ha de respondre. Per exemple <code>&lt;VirtualHost 192.168.2.112:80&gt;</code> si ha de respondre a l'adreça IP 192.168.2.112.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>&lt;VirtualHost 192.168.2.112:80&gt;
<span style="color: #993300;">DocumentRoot </span>"/var/www/serveisenxarxa/public_html"<strong>
</strong>&lt;/VirtualHost&gt;</code></pre>
</div>
</div>
<p></p>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextIdevice" id="id23">
<div class="iDevice emphasis0">
<div id="ta23_86" class="block iDevice_content">
<h2>Llocs virtuals basats en el nom de domini</h2>
<p>El problema dels llocs web virtuals basats en adreces d’Internet (IP) és que, considerant que s'allotgen molts dominis, necessitarem una adreça d’Internet (IP) per a cadascun dels dominis. Per tant, pot ser preferible treballar amb llocs virtuals basats en noms. En aquest cas, després de copiar l'arxiu de configuració per defecte, haurem d'afegir la directriu <code>ServerName</code> donat que, si bé els llocs virtuals es troben en la mateixa IP, s'ha de canviar el nom per a cadascun dels llocs. En el cas de treballar amb servidor DNS, aquest haurà d'estar configurat per resoldre aquests llocs en les zones corresponents. I la directiva DocumentRoot per a indicar des de quin directori es serviran les pàgines. Aquesta seria la configuració per a lloc www.serveisenxarxa.org:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>&lt;VirtualHost *:80&gt;
<span style="color: #993300;">ServerName</span> www.serveisenxarxa.org<span style="color: #993300;">
DocumentRoot </span>"/var/www/serveisenxarxa/public_html"<strong>
</strong>&lt;/VirtualHost&gt;</code></pre>
</div>
</div>
<p>Finalment, per verificar que tots els canvis aplicats han tingut èxit, tornarem a arrencar el servidor web.</p>
<p></p>
</div>
</div>
</div>
<div id="packageLicense" class="cc cc-by-sa">
<p><span>Obra publicada con</span> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Reconocimiento Compartir igual 4.0</a></p>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="prctica_2_instalacin_de_apache2.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="prctica_3_configuracin_bsica.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
</div>
<script type="text/javascript" src="_class_presentation_js.js"></script>
	<script type="text/javascript" src="prism.js"></script>
	<script type="text/javascript" src="_class_presentation_rgc_js.js"></script></body></html>