<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>06| Servidores virtuales | UNIDAD 5. Servicio web (HTTP) </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="es" />
<meta name="author" content="Roberto González Cardenete" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/4.0/" />
<meta name="generator" content="eXeLearning 2.9 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="prism.css">
</head>
<body class="exe-web-site exe-search-bar exe-atools" id="exe-node-11"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<div id="header" ><div id="headerContent">UNIDAD 5. Servicio web (HTTP)</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UNIDAD 5. Servicio web (HTTP)</a></li>
   <li><a href="01_introduccin.html" class="no-ch">01| Introducción</a></li>
   <li><a href="02_el_protocolo_http.html" class="daddy">02| El protocolo HTTP</a>
   <ul class="other-section">
      <li><a href="21_un_poco_de_historia.html" class="no-ch">2.1. Un poco de historia</a></li>
      <li><a href="22_caractersticas_de_http.html" class="no-ch">2.2. Características de HTTP</a></li>
   </ul>
   </li>
   <li><a href="03_etapas_de_una_transaccin_http.html" class="no-ch">03| Etapas de una transacción HTTP</a></li>
   <li><a href="04_el_estndar_http10.html" class="daddy">04| El estándar HTTP/1.0</a>
   <ul class="other-section">
      <li><a href="prctica_1_transacciones_http.html" class="no-ch">Práctica 1: Transacciones HTTP</a></li>
   </ul>
   </li>
   <li><a href="05_instalacin_y_configuracin_de_apache2.html" class="daddy">05| Instalación y configuración de Apache2</a>
   <ul class="other-section">
      <li><a href="prctica_2_instalacin_de_apache2.html" class="no-ch">Práctica 2: Instalación de Apache2</a></li>
   </ul>
   </li>
   <li id="active"><a href="06_servidores_virtuales.html" class="active daddy">06| Servidores virtuales</a>
   <ul>
      <li><a href="prctica_3_configuracin_bsica.html" class="no-ch">Práctica 3: Configuración básica</a></li>
   </ul>
   </li>
   <li><a href="07_acceso_annimo_y_autenticado_formas_de_autenticacin.html" class="daddy">07| Acceso anónimo y autenticado. Formas de autenticación</a>
   <ul class="other-section">
      <li><a href="prctica_4_control_de_acceso_autorizacin_y_autenticacin.html" class="no-ch">Práctica 4: Control de acceso, autorización y autenticación</a></li>
   </ul>
   </li>
   <li><a href="08_ejecucin_de_cdigo_scripts_de_servidor_y_de_cliente.html" class="daddy">08| Ejecución de código. Scripts de servidor y de cliente</a>
   <ul class="other-section">
      <li><a href="prctica_5_ejecucin_de_cdigo_en_el_cliente_y_en_el_servidor.html" class="no-ch">Práctica 5: Ejecución de código en el cliente y en el servidor</a></li>
   </ul>
   </li>
   <li><a href="09_establecimiento_de_conexiones_seguras.html" class="daddy">09| Establecimiento de conexiones seguras</a>
   <ul class="other-section">
      <li><a href="prctica_6_asegurando_las_comunicaciones.html" class="no-ch">Práctica 6: Asegurando las comunicaciones</a></li>
   </ul>
   </li>
   <li><a href="10_mapa_conceptual.html" class="no-ch">10| Mapa conceptual</a></li>
   <li><a href="11_cuestionario_de_repaso.html" class="no-ch">11| Cuestionario de repaso</a></li>
   <li><a href="12_bibliografia.html" class="no-ch">12| Bibliografia</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="prctica_2_instalacin_de_apache2.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="prctica_3_configuracin_bsica.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">06| Servidores virtuales</h1></div>
<div class="iDevice_wrapper FreeTextIdevice" id="id22">
<div class="iDevice emphasis0">
<div id="ta22_86" class="block iDevice_content">
<p>Cuando hablamos de la creación de sitios virtuales nos referimos a la acción de hacer funcionar más de un sitio web, por ejemplo, las páginas web <code>www.web1.cat</code> y <code>www.web2.cat</code> en un único ordenador.</p>
<p>Tal como muestra la siguiente figura, aunque ambos dominios estén funcionando en la misma máquina física, nunca nos daremos cuenta cuando visitamos estos sitios web.</p>
<p><img src="smx_m07u3-36_1.png" alt="Servidores virtuales" title="Servidores virtuales" style="display: block; margin-left: auto; margin-right: auto;" width="430" height="623" /></p>
<p>Los sitios web virtuales pueden <strong>basarse tanto en direcciones de Internet (IP)</strong>, donde cada sitio web tiene una dirección de Internet (IP) diferente, como <strong>en nombres diferentes</strong>, es decir, varios sitios web con diferentes nombres de dominio estarán funcionando con una única dirección de Internet (IP). Cabe destacar que, aunque estemos trabajando en la misma máquina física, como usuarios no percibiremos esta diferencia al visitar estos sitios web.</p>
<p>Para explicar la técnica de la creación de sitios web virtuales, trabajaremos con dos ejemplos:<code> www.aplicacionesweb.org</code> y <code>www.serveisenxarxa.org</code>.</p>
<p>Ambos sitios web virtuales serán servidos por el mismo servidor web. El directorio por defecto donde se encuentran las páginas web es <code>/var/www</code>, donde crearemos las diferentes estructuras de directorio. Por lo tanto, dentro de los directorios <code>/var/www/aplicacionesweb</code> y <code>/var/www/seveisenxarxa</code> encontraremos los archivos de los sitios web correspondientes a las páginas web anteriores.</p>
<p>Para la configuración y puesta en marcha de los sitios web virtuales, primero debemos construir la estructura de directorios donde almacenaremos los sitios. Dentro del directorio reservado a cada sitio web, utilizaremos la carpeta <code>public_html</code> para alojar los archivos del sitio web.</p>
<p>Una vez definidos los directorios donde almacenaremos los sitios web virtuales, debemos dirigirnos al directorio <code>/etc/apache2</code>, donde encontraremos los archivos de configuración de Apache. En este caso, el archivo principal de configuración es <code>apache2.conf</code>.</p>
<p>Considerando que para trabajar con los sitios virtuales debemos realizar algunos cambios en el contenido del archivo, es importante definir previamente qué tipo de configuración de sitios web virtuales queremos crear, es decir, sitios virtuales basados en direcciones de Internet (IP) o bien basados en nombres.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextIdevice" id="id25">
<div class="iDevice emphasis0">
<div id="ta25_86" class="block iDevice_content">
<h3>Servidores virtuales en Apache</h3>
<p>Apache2 se entrega con una configuración predeterminada <em>virtual-host-friendly</em>. Es decir, está configurado con un único <em>host</em> virtual predeterminado (utilizando la directiva <code>VirtualHost</code>) que se puede modificar o utilizar como si tuviera un solo sitio o como plantilla para servidores virtuales adicionales si tienes varios sitios. Si se deja tal cual, el anfitrión virtual predeterminado servirá como sitio por defecto o los usuarios verán este sitio si la URL que introducen no coincide con la directiva <code>ServerName</code> de ninguno de sus sitios personalizados. Para modificar el servidor virtual predeterminado, edita el archivo <code>/etc/apache2/sites-available/000-default.conf.</code></p>
<p>Si deseas configurar un nuevo host virtual o sitio, copia estos archivos en el mismo directorio con el nombre que elijas. Por ejemplo:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/misitio.conf</code></pre>
</div>
</div>
<p>La configuración por defecto es la siguiente:</p>
<div class="highlighted-code language-clike line-numbers">
<div>
<pre><code>&lt;VirtualHost *:80&gt;
	# La directiva ServerName establece el esquema de solicitud, el nombre de host y el puerto
	# que el servidor usa para identificarse. Se usa al crear URLs de redirección.
	# Para hosts virtuales, ServerName especifica qué nombre de host debe aparecer en la
	# cabecera Host: de la solicitud para coincidir con este host virtual.
	# Para el host virtual predeterminado, este valor no es decisivo ya que se usa como
	# último recurso.
	#ServerName www.example.com

	ServerAdmin webmaster@localhost
	DocumentRoot /var/www/html

	# Niveles de log disponibles: trace8, ..., trace1, debug, info, notice, warn,
	# error, crit, alert, emerg.
	# También es posible configurar el nivel de log para módulos específicos.
	#LogLevel info ssl:warn

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	# Para la mayoría de los archivos de configuración en conf-available/
	# que se activan o desactivan globalmente, es posible incluir
	# una línea para un host virtual en particular. Por ejemplo:
	#Include conf-available/serve-cgi-bin.conf
&lt;/VirtualHost&gt;

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet</code></pre>
</div>
</div>
<p>Una vez realizados los cambios, activaremos el sitio web con el comando <code>a2ensite</code>:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo a2ensite misitio</code></pre>
</div>
</div>
<p>Luego, recargaremos la configuración de Apache2 con el siguiente comando:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo service apache2 reload</code></pre>
</div>
</div>
<p>Para depurar errores en los archivos de configuración de sitios virtuales, usa:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>sudo apache2ctl -t</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextIdevice" id="id24">
<div class="iDevice emphasis0">
<div id="ta24_86" class="block iDevice_content">
<h2>Sitios virtuales basados en la dirección de Internet (IP)</h2>
<p>En este caso, podemos alojar múltiples dominios en una única máquina que dispondrá de diferentes direcciones de Internet (IP) y, en cada una de ellas, se ejecutará un sitio virtual.</p>
<p>Debemos cambiar la directiva <code>&lt;VirtualHost *:80&gt;</code> para especificar a qué dirección IP debe responder. Por ejemplo, <code>&lt;VirtualHost 192.168.2.112:80&gt;</code> si debe responder a la dirección IP 192.168.2.112.</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>&lt;VirtualHost 192.168.2.112:80&gt;
<span style="color: #993300;">DocumentRoot </span>"/var/www/serveisenxarxa/public_html"<strong>
</strong>&lt;/VirtualHost&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextIdevice" id="id23">
<div class="iDevice emphasis0">
<div id="ta23_86" class="block iDevice_content">
<h2>Sitios virtuales basados en el nombre de dominio</h2>
<p>El problema de los sitios web virtuales basados en direcciones de Internet (IP) es que, considerando que se alojan muchos dominios, necesitaremos una dirección de Internet (IP) para cada uno de los dominios. Por lo tanto, puede ser preferible trabajar con sitios virtuales basados en nombres. En este caso, después de copiar el archivo de configuración por defecto, debemos agregar la directiva <code>ServerName</code> ya que, aunque los sitios virtuales se encuentren en la misma IP, se debe cambiar el nombre para cada uno de los sitios. En el caso de trabajar con un servidor DNS, este deberá estar configurado para resolver estos sitios en las zonas correspondientes. Además, se debe definir la directiva <code>DocumentRoot</code> para indicar desde qué directorio se servirán las páginas. Esta sería la configuración para el sitio www.serveisenxarxa.org:</p>
<div class="highlighted-code language-clike">
<div>
<pre><code>&lt;VirtualHost *:80&gt;
<span style="color: #993300;">ServerName</span> www.serveisenxarxa.org<span style="color: #993300;">
DocumentRoot </span>"/var/www/serveisenxarxa/public_html"<strong>
</strong>&lt;/VirtualHost&gt;</code></pre>
</div>
</div>
<p>Finalmente, para verificar que todos los cambios aplicados han tenido éxito, reiniciaremos el servidor web.</p>
</div>
</div>
</div>
<div id="packageLicense" class="cc cc-by-sa">
<p><span>Obra publicada con</span> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Reconocimiento Compartir igual 4.0</a></p>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="prctica_2_instalacin_de_apache2.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="prctica_3_configuracin_bsica.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
</div>
<script type="text/javascript" src="class_presentation_js.js"></script>
	<script type="text/javascript" src="prism.js"></script>
	<script type="text/javascript" src="class_presentation_rgc_js.js"></script></body></html>